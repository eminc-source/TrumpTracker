<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trump Tracker Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-green: #22c55e;
            --accent-yellow: #eab308;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --border-color: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        
        body { background-color: var(--bg-dark); color: var(--text-primary); padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .header h1 { font-size: 24px; font-weight: 700; letter-spacing: -0.5px; }
        .last-updated { font-size: 14px; color: var(--text-secondary); }

        /* KPI Grid */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        
        .card { background-color: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        .score-title { font-size: 14px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 10px; }
        .score-value { font-size: 36px; font-weight: 800; margin-bottom: 5px; }
        .score-status { font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 6px; }
        .score-status::before { content: ''; display: block; width: 10px; height: 10px; border-radius: 50%; }

        /* Main Dashboard Grid */
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        @media (max-width: 1024px) { .dashboard-grid { grid-template-columns: 1fr; } }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th { text-align: left; color: var(--text-secondary); font-size: 12px; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
        .data-table td { padding: 12px 0; border-bottom: 1px solid #33415540; font-size: 14px; }
        .data-table .trend { font-weight: 600; font-size: 12px; padding: 2px 8px; border-radius: 4px; }
        
        .trend-up { color: var(--accent-red); background: #450a0a; } /* Cost going up is bad usually */
        .trend-down { color: var(--accent-green); background: #052e16; } /* Cost going down is good */
        .trend-stable { color: var(--text-secondary); background: #334155; }
        
        /* Specific override: For Home Value, Up is Green? 
           The sheet implies 'Higher = Better' for Supply/Affordability scores, 
           but for expenses 'Rise' is marked with arrows. 
           I will stick to the sheet's visual cues: Rise = Red for expenses. */

        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .section-title span { color: var(--accent-orange); }

        /* Color Utility Classes */
        .text-green { color: var(--accent-green); }
        .text-yellow { color: var(--accent-yellow); }
        .text-orange { color: var(--accent-orange); }
        .text-red { color: var(--accent-red); }
        
        .bg-green::before { background-color: var(--accent-green); }
        .bg-yellow::before { background-color: var(--accent-yellow); }
        .bg-orange::before { background-color: var(--accent-orange); }
        .bg-red::before { background-color: var(--accent-red); }

        /* Toggle Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
        .tab-btn.active { background: var(--accent-orange); color: white; border-color: var(--accent-orange); }

        .footer-note { margin-top: 40px; font-size: 12px; color: var(--text-secondary); text-align: center; }

        /* Legend Section */
        .legend-section { margin-bottom: 20px; }
        .legend-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 20px; 
            background: var(--card-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .legend-header:hover { background: #253249; }
        .legend-header h2 { font-size: 18px; font-weight: 600; margin: 0; }
        .toggle-icon { font-size: 14px; color: var(--text-secondary); transition: transform 0.3s; }
        .toggle-icon.collapsed { transform: rotate(-90deg); }
        
        .legend-content {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 20px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        .legend-content.hidden { max-height: 0; padding: 0 20px; }
        
        .legend-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 20px; 
        }
        @media (max-width: 1200px) { .legend-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .legend-grid { grid-template-columns: 1fr; } }
        
        .legend-card { 
            background: rgba(15, 23, 42, 0.5); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            padding: 16px;
            border-top: 3px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }
        .legend-card[data-color="red"] { border-top-color: var(--accent-red); }
        .legend-card[data-color="orange"] { border-top-color: var(--accent-orange); }
        .legend-card[data-color="yellow"] { border-top-color: var(--accent-yellow); }
        .legend-card[data-color="green"] { border-top-color: var(--accent-green); }
        
        .legend-card h3 { 
            font-size: 12px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            margin-bottom: 10px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .legend-card[data-color="red"] h3 { color: var(--accent-red); }
        .legend-card[data-color="orange"] h3 { color: var(--accent-orange); }
        .legend-card[data-color="yellow"] h3 { color: var(--accent-yellow); }
        .legend-card[data-color="green"] h3 { color: var(--accent-green); }
        .legend-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.5; }
        .legend-note { font-size: 12px; color: var(--accent-yellow); margin-bottom: 10px; }
        
        .legend-factors { 
            font-size: 12px; 
            color: var(--text-secondary); 
            margin-bottom: 12px; 
            padding-left: 16px;
            list-style: disc;
        }
        .legend-factors li { margin-bottom: 3px; }
        
        .legend-list { list-style: none; padding: 0; margin: 0; margin-top: auto; }
        .legend-list li { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 6px 0; 
            font-size: 13px;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }
        .legend-list li:last-child { border-bottom: none; }
        .legend-list .range { color: var(--text-secondary); margin-left: auto; font-size: 12px; }
        
        .dot { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            flex-shrink: 0;
        }
        .dot.green { background: var(--accent-green); }
        .dot.yellow { background: var(--accent-yellow); }
        .dot.orange { background: var(--accent-orange); }
        .dot.red { background: var(--accent-red); }
        .dot.red.dark { background: #b91c1c; }
        .dot.fire { background: none; font-size: 12px; line-height: 1; }

        /* Regional Cards */
        .regional-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        @media (max-width: 1024px) { .regional-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .regional-grid { grid-template-columns: 1fr; } }
        
        .regional-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        .regional-card h4 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .regional-card .affordability-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        .regional-card .affordability-change {
            font-size: 13px;
            font-weight: 500;
        }
        .regional-card .home-price {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Investments Grid */
        .investments-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) { .investments-grid { grid-template-columns: 1fr; } }
        
        .investment-section {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }
        .investment-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-orange);
            margin-bottom: 12px;
        }

        /* Chart Container */
        .chart-container {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            height: 350px;
        }
        
        /* Economic Stats */
        .economic-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        @media (max-width: 768px) { .economic-stats { grid-template-columns: repeat(2, 1fr); } }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* Key 3 Section */
        .key3-section { margin-bottom: 20px; }
        .key3-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 20px; 
            background: var(--card-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .key3-header:hover { background: #253249; }
        .key3-header h2 { font-size: 18px; font-weight: 600; margin: 0; }
        
        .key3-content {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 25px;
            overflow: hidden;
        }
        .key3-content.hidden { display: none; }
        
        .key3-formula {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        
        .key3-component {
            background: rgba(15, 23, 42, 0.5);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px 25px;
            text-align: center;
            min-width: 140px;
        }
        .key3-component .key3-weight {
            font-size: 12px;
            color: var(--accent-orange);
            font-weight: 700;
            margin-bottom: 5px;
        }
        .key3-component .key3-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .key3-component .key3-value {
            font-size: 28px;
            font-weight: 800;
        }
        
        .key3-operator {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-secondary);
        }
        
        .key3-result {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(249, 115, 22, 0.2));
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            min-width: 160px;
        }
        .key3-result .key3-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .key3-result .key3-value {
            font-size: 36px;
            font-weight: 800;
        }
        
        .key3-breakdown {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 15px 20px;
        }
        .key3-calc-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }
        .key3-calc-row:last-child { border-bottom: none; }
        .key3-calc-row.total {
            padding-top: 12px;
            margin-top: 5px;
            border-top: 1px solid var(--border-color);
            font-weight: 600;
        }
        .calc-label { color: var(--text-secondary); }
        .calc-formula { color: var(--text-primary); font-family: 'SF Mono', monospace; }
        
        /* Data Source Indicator */
        .data-source-indicator {
            display: flex;
            gap: 15px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 10px;
            align-items: center;
        }
        .source-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .source-dot.live { background-color: var(--green); animation: pulse 2s infinite; }
        .source-dot.cached { background-color: var(--yellow); }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Live data badge */
        .live-badge {
            font-size: 0.6rem;
            background: var(--green);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .cached-badge {
            font-size: 0.6rem;
            background: var(--text-secondary);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        /* Source Links */
        .source-link {
            color: var(--text-primary);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s ease;
        }
        .source-link:hover {
            color: var(--accent-blue);
        }
        .source-badge {
            font-size: 0.55rem;
            background: var(--accent-blue);
            color: white;
            padding: 2px 5px;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            opacity: 0.8;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .source-link:hover .source-badge,
        .source-badge-link:hover .source-badge {
            opacity: 1;
            transform: scale(1.05);
        }
        .source-badge-link {
            text-decoration: none;
            margin-left: 6px;
        }
        
        /* Different source colors */
        .source-badge[data-source="FRED"] { background: #003366; }
        .source-badge[data-source="BLS"] { background: #2e7d32; }
        .source-badge[data-source="NAR"] { background: #c62828; }
        .source-badge[data-source="Census"] { background: #6a1b9a; }
        .source-badge[data-source="Congress.gov"] { background: #1565c0; }
        .source-badge[data-source="CoinGecko"] { background: #8dc647; color: #000; }
        .source-badge[data-source="Yahoo"] { background: #6001d2; }
        .source-badge[data-source="CoreLogic"] { background: #e65100; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>TRUMP TRACKER DASHBOARD</h1>
            <div class="last-updated" id="lastUpdated">Loading...</div>
        </div>
        <div>
            </div>
    </div>

    <div class="kpi-grid" id="scoreContainer">
        </div>

    <!-- The Key 3 Visual -->
    <div class="key3-section">
        <div class="key3-header" onclick="toggleKey3()">
            <h2>üîë The Key 3 ‚Äî How We Calculate Housing Health</h2>
            <span class="toggle-icon collapsed" id="key3Toggle">‚ñº</span>
        </div>
        <div class="key3-content hidden" id="key3Content">
            <div class="key3-formula">
                <div class="key3-component" id="key3Supply">
                    <div class="key3-weight">35%</div>
                    <div class="key3-label">Supply Score</div>
                    <div class="key3-value">--</div>
                </div>
                <div class="key3-operator">+</div>
                <div class="key3-component" id="key3Affordability">
                    <div class="key3-weight">45%</div>
                    <div class="key3-label">Affordability Score</div>
                    <div class="key3-value">--</div>
                </div>
                <div class="key3-operator">+</div>
                <div class="key3-component" id="key3Crash">
                    <div class="key3-weight">20%</div>
                    <div class="key3-label">Inverted Crash Score</div>
                    <div class="key3-value">--</div>
                </div>
                <div class="key3-operator">=</div>
                <div class="key3-result" id="key3Result">
                    <div class="key3-label">Housing Health</div>
                    <div class="key3-value">--</div>
                </div>
            </div>
            <div class="key3-breakdown">
                <div class="key3-calc-row">
                    <span class="calc-label">Supply Contribution:</span>
                    <span class="calc-formula" id="calcSupply">-- √ó 0.35 = --</span>
                </div>
                <div class="key3-calc-row">
                    <span class="calc-label">Affordability Contribution:</span>
                    <span class="calc-formula" id="calcAffordability">-- √ó 0.45 = --</span>
                </div>
                <div class="key3-calc-row">
                    <span class="calc-label">Crash Contribution:</span>
                    <span class="calc-formula" id="calcCrash">(100 - --) √ó 0.20 = --</span>
                </div>
                <div class="key3-calc-row total">
                    <span class="calc-label">Total:</span>
                    <span class="calc-formula" id="calcTotal">-- + -- + -- = <strong>--</strong></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Legend Section -->
    <div class="legend-section">
        <div class="legend-header" onclick="toggleLegend()">
            <h2>üìñ Score Legend & Methodology</h2>
            <span class="toggle-icon collapsed" id="legendToggle">‚ñº</span>
        </div>
        <div class="legend-content hidden" id="legendContent">
            <div class="legend-grid">
                <!-- Housing Health Score - matches 1st KPI -->
                <div class="legend-card" id="legendCard0">
                    <h3>Housing Health Score</h3>
                    <p class="legend-desc">Composite score calculated from:</p>
                    <ul class="legend-factors">
                        <li>45% of the Affordability Score</li>
                        <li>35% of the Supply Score</li>
                        <li>20% of the Inverted Crash Score</li>
                    </ul>
                    <ul class="legend-list">
                        <li><span class="dot green"></span> <strong>Affordable Housing</strong> <span class="range">(85‚Äì100)</span></li>
                        <li><span class="dot yellow"></span> <strong>Buyer's Market</strong> <span class="range">(72.5‚Äì84.9)</span></li>
                        <li><span class="dot orange"></span> <strong>Neutral Market</strong> <span class="range">(60‚Äì72.4)</span></li>
                        <li><span class="dot red"></span> <strong>Affordability Crisis</strong> <span class="range">(50‚Äì59.9)</span></li>
                        <li><span class="dot red dark"></span> <strong>Nowhere Close to Affordable</strong> <span class="range">(40‚Äì49.9)</span></li>
                        <li><span class="dot fire">üî•</span> <strong>Crisis Mode</strong> <span class="range">(&lt;40)</span></li>
                    </ul>
                </div>

                <!-- Supply Score - matches 2nd KPI -->
                <div class="legend-card" id="legendCard1">
                    <h3>Supply Score</h3>
                    <p class="legend-desc">We take the current supply of homes and compare it to a national target. The result is scaled from 0 to 100 based on how close we are to needed home inventory.</p>
                    <p class="legend-note"><em>Note: formula favors AFFORDABLE housing in scoring</em></p>
                    <ul class="legend-list">
                        <li><span class="dot green"></span> <strong>Balanced</strong> <span class="range">(90‚Äì100)</span></li>
                        <li><span class="dot yellow"></span> <strong>Slight Undersupply</strong> <span class="range">(70‚Äì89.9)</span></li>
                        <li><span class="dot orange"></span> <strong>Tight Market</strong> <span class="range">(45‚Äì69.9)</span></li>
                        <li><span class="dot red"></span> <strong>Critical Shortage</strong> <span class="range">(&lt;45)</span></li>
                    </ul>
                </div>

                <!-- Affordability Score - matches 3rd KPI -->
                <div class="legend-card" id="legendCard2">
                    <h3>Affordability Score</h3>
                    <p class="legend-desc">Calculated using weighted factors:</p>
                    <ul class="legend-factors">
                        <li>First-Time Buyer Affordability (max 40 pts)</li>
                        <li>National Affordability Index (20 pts)</li>
                        <li>Mortgage Rate (15 pts)</li>
                        <li>10-Year Treasury (7.5 pts)</li>
                        <li>Median Household Income (17.5 pts)</li>
                    </ul>
                    <ul class="legend-list">
                        <li><span class="dot green"></span> <strong>Affordable</strong> <span class="range">(80‚Äì100)</span></li>
                        <li><span class="dot yellow"></span> <strong>Pressured</strong> <span class="range">(60‚Äì79.9)</span></li>
                        <li><span class="dot orange"></span> <strong>Strained</strong> <span class="range">(40‚Äì59.9)</span></li>
                        <li><span class="dot red"></span> <strong>Meltdown</strong> <span class="range">(&lt;40)</span></li>
                    </ul>
                </div>

                <!-- Crash Likelihood - matches 4th KPI -->
                <div class="legend-card" id="legendCard3">
                    <h3>Crash Likelihood</h3>
                    <p class="legend-desc">We total all macroeconomic pressure points using a fluid scoring formula from 15 leading indicators (e.g., delinquencies, vacancies, job market, yield curve).</p>
                    <ul class="legend-list">
                        <li><span class="dot red"></span> <strong>MELTDOWN</strong> <span class="range">(100‚Äì135)</span></li>
                        <li><span class="dot red"></span> <strong>Crash in Sight</strong> <span class="range">(80‚Äì99.9)</span></li>
                        <li><span class="dot yellow"></span> <strong>Correction in Sight</strong> <span class="range">(70‚Äì79.9)</span></li>
                        <li><span class="dot green"></span> <strong>Buyer's Market</strong> <span class="range">(45‚Äì69.9)</span></li>
                        <li><span class="dot green"></span> <strong>Strong Seller's Market</strong> <span class="range">(&lt;45)</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchView('metrics')">Housing Metrics</button>
        <button class="tab-btn" onclick="switchView('costs')">Cost Trackers</button>
        <button class="tab-btn" onclick="switchView('regional')">Regional</button>
        <button class="tab-btn" onclick="switchView('investments')">Investments</button>
        <button class="tab-btn" onclick="switchView('economic')">Economic Index</button>
        <button class="tab-btn" onclick="switchView('legislation')">Legislation</button>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <div id="metricsView">
                <div class="section-title"><span>üè†</span> Market Health Indicators</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>KPI</th>
                            <th>Current</th>
                            <th>Start of Term</th>
                            <th>Change</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="housingMetricsBody"></tbody>
                </table>
            </div>

            <div id="costsView" style="display:none;">
                <div class="section-title"><span>üî®</span> Builder & Household Expenses</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Current Price</th>
                            <th>Start Price</th>
                            <th>Change</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody id="costTrackerBody"></tbody>
                </table>
            </div>

            <div id="legislationView" style="display:none;">
                <div class="section-title"><span>‚öñÔ∏è</span> Bill Tracker</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Bill #</th>
                            <th>Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="billTrackerBody"></tbody>
                </table>
            </div>

            <div id="regionalView" style="display:none;">
                <div class="section-title"><span>üó∫Ô∏è</span> Affordability by Region</div>
                <div class="regional-grid" id="regionalContainer"></div>
                <table class="data-table" style="margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Region</th>
                            <th>Resale Home</th>
                            <th>Qualifying Income</th>
                            <th>Family Income</th>
                            <th>Monthly Mortgage</th>
                            <th>Affordability</th>
                            <th>YoY Change</th>
                        </tr>
                    </thead>
                    <tbody id="regionalTableBody"></tbody>
                </table>
            </div>

            <div id="investmentsView" style="display:none;">
                <div class="section-title"><span>üìà</span> Investment Tracker</div>
                
                <div class="investments-grid">
                    <div class="investment-section">
                        <h4>üí∞ Commodities & Markets</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Asset</th>
                                    <th>Value</th>
                                    <th>MoM</th>
                                    <th>YoY</th>
                                </tr>
                            </thead>
                            <tbody id="assetsTableBody"></tbody>
                        </table>
                    </div>
                    <div class="investment-section">
                        <h4>üè¶ Treasury Yields</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Term</th>
                                    <th>Rate</th>
                                    <th>MoM</th>
                                    <th>YoY</th>
                                </tr>
                            </thead>
                            <tbody id="yieldsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="economicView" style="display:none;">
                <div class="section-title"><span>üìä</span> Economic Cost Index</div>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">
                    We compare each item's current cost to its 2019 Q1 cost, weight essentials (food, utilities, rent, insurance, medical, etc.) more heavily than discretionary items, average those ratios, and scale the result so 2019 Q1 equals 100.
                </p>
                <div class="chart-container">
                    <canvas id="economicChart"></canvas>
                </div>
                <div class="economic-stats">
                    <div class="stat-card">
                        <div class="stat-label">Current Index</div>
                        <div class="stat-value text-red" id="currentIndex">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Since 2019 Q1</div>
                        <div class="stat-value text-red" id="sinceBaseline">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">YoY Change</div>
                        <div class="stat-value" id="yoyChange">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">MoM Change</div>
                        <div class="stat-value" id="momChange">--</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-title"><span>üìâ</span> Crash Likelihood Tracker</div>
            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                Macroeconomic pressure points based on 15 leading indicators.
            </p>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Current</th>
                        <th>Points</th>
                        <th>Risk Level</th>
                    </tr>
                </thead>
                <tbody id="crashTrackerBody"></tbody>
            </table>
        </div>
    </div>

    <div class="footer-note">
        Data sourced from 'HOUSING AFFORDABILITY TRACKER (live)'. Updates every morning at 9:15 EST.
    </div>

    <script>
        // --- API CONFIGURATION ---
        const CONFIG = {
            FRED_API_KEY: 'e3ce98f0bd1a899435223a2728c4d64a',
            GOOGLE_SHEET_ID: '1VNPGRB5ZcrxxIk_27Mmbe10nxc5wyCuHJPpD4ZGSvEU',
            CACHE_DURATION: 1000 * 60 * 60, // 1 hour cache
        };

        // FRED Series IDs for data we want to fetch
        const FRED_SERIES = {
            // Mortgage & Rates
            MORTGAGE30US: 'mortgageRate',      // 30-Year Fixed Rate Mortgage
            FEDFUNDS: 'fedRate',               // Federal Funds Rate
            DGS10: 'treasury10yr',             // 10-Year Treasury
            DGS1: 'treasury1yr',               // 1-Year Treasury
            DGS2: 'treasury2yr',               // 2-Year Treasury
            DGS5: 'treasury5yr',               // 5-Year Treasury
            DGS20: 'treasury20yr',             // 20-Year Treasury
            DGS30: 'treasury30yr',             // 30-Year Treasury
            UNRATE: 'unemploymentRate',        // Unemployment Rate
            CPIAUCSL: 'cpi',                   // Consumer Price Index
            PERMIT: 'buildingPermits',         // Building Permits
            JTSJOL: 'jobOpenings',             // Job Openings (JOLTS)
            ICSA: 'joblessClaims',             // Initial Jobless Claims
            MSPUS: 'medianHomePrice',          // Median Sales Price of Houses
            
            // Housing Supply & Inventory
            ACTLISCOUUS: 'totalHomesForSale',  // Active Listing Count (Total Inventory)
            MSACSR: 'newHomesForSale',         // Monthly Supply of New Houses
            HOUST: 'housingStarts',            // Housing Starts
            
            // Crash Tracker - Delinquencies & Risk
            DRSFRMACBS: 'mortgageDelinquency', // Delinquency Rate on Single-Family Mortgages
            DRCCLACBS: 'creditCardDelinquency',// Credit Card Delinquency Rate
            DRBLACBS: 'businessLoanDelinquency', // Business Loan Delinquency Rate
            DRALACBS: 'allLoansDelinquency',   // Delinquency Rate on All Loans
            DRCLACBS: 'autoLoanDelinquency',   // Consumer Loans Delinquency (Auto)
            RRVRUSQ156N: 'rentalVacancy',      // Rental Vacancy Rate
            T10Y2Y: 'yieldCurve',              // 10Y-2Y Treasury Spread (Yield Curve)
            STLFSI4: 'financialStress',        // St. Louis Fed Financial Stress Index
            TDSP: 'debtServiceRatio',          // Household Debt Service Ratio
            
            // Food Prices
            APU0000708111: 'eggPrice',         // Eggs, grade A, large, per doz.
            APU0000709112: 'milkPrice',        // Milk, fresh, whole, per gal.
            APU0000702111: 'breadPrice',       // Bread, white, pan, per lb.
            APU0000717311: 'coffeePrice',      // Coffee, 100%, ground roast, per lb.
            APU0000711211: 'bananaPrice',      // Bananas, per lb.
            APU0000703112: 'beefPrice',        // Ground beef, 100% beef, per lb.
            APU0000704111: 'baconPrice',       // Bacon, sliced, per lb.
            APU0000706111: 'chickenPrice',     // Chicken breast, boneless, per lb.
            APU0000715211: 'sugarPrice',       // Sugar, white, per lb.
            APU0000711311: 'orangePrice',      // Oranges, per lb.
            APU0000710212: 'cheesePrice',      // Cheddar cheese, per lb.
            
            // Energy & Utilities  
            GASREGW: 'gasPrice',               // Regular Gas Price
            GASDESW: 'dieselPrice',            // Diesel Gas Price
            APU000072610: 'electricityPrice',  // Electricity per KWH
            APU000072501: 'natGasPrice',       // Utility natural gas per therm
            
            // Stock Market (FRED has these!)
            SP500: 'sp500',                    // S&P 500
            DJIA: 'dowJones',                  // Dow Jones Industrial Average
            
            // More Builder/Construction
            WPU0811: 'lumberPrice',            // Softwood Lumber PPI
            WPU101: 'steelPrice',              // Steel Mill Products PPI
            PCU3273123273120: 'concretePrice', // Concrete Products PPI
            
            // Core Inflation & Income
            CPILFESL: 'coreInflation',         // Core CPI (less food & energy)
            MEHOINUSA672N: 'medianIncome',     // Median Household Income
            
            // Insurance & Services (CPI indices - need to divide by ~2.5 for actual $)
            CUSR0000SETE01: 'carInsuranceCPI', // Motor Vehicle Insurance CPI
            CUSR0000SAM: 'medicalCareCPI',     // Medical Care CPI
            CUSR0000SEHA: 'rentCPI',           // Rent of Primary Residence CPI
            CUSR0000SAA: 'apparelCPI',         // Apparel CPI
            CUSR0000SAE1: 'educationCPI',      // Education CPI
            CUSR0000SAH3: 'furnitureCPI',      // Household Furnishings CPI
            
            // Housing Market
            CSUSHPINSA: 'caseShiller',         // Case-Shiller Home Price Index
            HOUST: 'housingStarts',            // Housing Starts (thousands)
            
            // Market Volatility - moved to Yahoo Finance for real-time
            // VIX, Gold, Silver, Platinum, S&P 500, Dow Jones now from Yahoo
        };

        // CoinGecko Crypto IDs
        const CRYPTO_IDS = ['bitcoin', 'ethereum', 'ripple', 'solana'];
        
        // Fetch crypto prices from CoinGecko (free, no API key needed)
        async function fetchCryptoPrices() {
            try {
                const ids = CRYPTO_IDS.join(',');
                const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`CoinGecko API error: ${response.status}`);
                const data = await response.json();
                return {
                    bitcoin: { price: data.bitcoin?.usd, change24h: data.bitcoin?.usd_24h_change },
                    ethereum: { price: data.ethereum?.usd, change24h: data.ethereum?.usd_24h_change },
                    xrp: { price: data.ripple?.usd, change24h: data.ripple?.usd_24h_change },
                    solana: { price: data.solana?.usd, change24h: data.solana?.usd_24h_change },
                    source: 'CoinGecko'
                };
            } catch (error) {
                console.warn('CoinGecko fetch failed:', error.message);
                return null;
            }
        }
        
        // Yahoo Finance symbols for market data
        const YAHOO_SYMBOLS = {
            'GC=F': 'gold',           // Gold Futures
            'SI=F': 'silver',         // Silver Futures
            'PL=F': 'platinum',       // Platinum Futures
            '^GSPC': 'sp500',         // S&P 500
            '^DJI': 'dowJones',       // Dow Jones
            '^VIX': 'vix'             // VIX Volatility
        };
        
        // Fetch market data from Yahoo Finance via CORS proxy
        async function fetchYahooFinance() {
            const results = {};
            const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
            
            for (const [symbol, key] of Object.entries(YAHOO_SYMBOLS)) {
                try {
                    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}`;
                    const url = CORS_PROXY + encodeURIComponent(yahooUrl);
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Yahoo API error: ${response.status}`);
                    const data = await response.json();
                    const meta = data.chart?.result?.[0]?.meta;
                    if (meta && meta.regularMarketPrice) {
                        results[key] = {
                            current: meta.regularMarketPrice,
                            previousClose: meta.previousClose || meta.chartPreviousClose,
                            change: meta.regularMarketPrice - (meta.previousClose || meta.chartPreviousClose),
                            changePercent: ((meta.regularMarketPrice - (meta.previousClose || meta.chartPreviousClose)) / (meta.previousClose || meta.chartPreviousClose) * 100)
                        };
                    }
                } catch (error) {
                    console.warn(`Yahoo Finance fetch failed for ${symbol}:`, error.message);
                }
            }
            
            return Object.keys(results).length > 0 ? results : null;
        }
        
        // Data Source Links - Maps data names to their source URLs
        const DATA_SOURCES = {
            // Housing Metrics
            "Resale Home (Median)": { url: "https://fred.stlouisfed.org/series/MSPUS", source: "FRED" },
            "New Construction (Median)": { url: "https://www.census.gov/construction/nrs/index.html", source: "Census" },
            "Affordable Home (Median)": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics", source: "NAR" },
            
            // Mortgage & Rates
            "Mortgage Rate": { url: "https://fred.stlouisfed.org/series/MORTGAGE30US", source: "FRED" },
            "Fed Rate": { url: "https://fred.stlouisfed.org/series/FEDFUNDS", source: "FRED" },
            "10 Year Treasury Yield": { url: "https://fred.stlouisfed.org/series/DGS10", source: "FRED" },
            "Core Inflation Y.O.Y.": { url: "https://fred.stlouisfed.org/series/CPILFESL", source: "FRED" },
            "Median Mortgage p/month": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/housing-affordability-index", source: "NAR" },
            
            // Affordability
            "FTHB Affordability Index": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/housing-affordability-index", source: "NAR" },
            "Housing Affordability Index": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/housing-affordability-index", source: "NAR" },
            "Median Household Income": { url: "https://fred.stlouisfed.org/series/MEHOINUSA672N", source: "FRED" },
            
            // Supply
            "Total Homes for Sale": { url: "https://fred.stlouisfed.org/series/ACTLISCOUUS", source: "FRED" },
            "New Construction for Sale": { url: "https://fred.stlouisfed.org/series/MSACSR", source: "FRED" },
            "Resale Homes for Sale": { url: "https://fred.stlouisfed.org/series/EXHOSLUSM495S", source: "FRED" },
            "Building Permits": { url: "https://fred.stlouisfed.org/series/PERMIT", source: "FRED" },
            
            // Builder Materials
            "Softwood Lumber": { url: "https://fred.stlouisfed.org/series/WPU0811", source: "FRED" },
            "Steel": { url: "https://fred.stlouisfed.org/series/WPU101", source: "FRED" },
            "Shingles": { url: "https://www.bls.gov/ppi/", source: "BLS" },
            "Plumbing": { url: "https://www.bls.gov/ppi/", source: "BLS" },
            "Concrete": { url: "https://fred.stlouisfed.org/series/WPU1321", source: "FRED" },
            
            // Food
            "Food Overall": { url: "https://fred.stlouisfed.org/series/CPIUFDSL", source: "FRED" },
            "Eggs": { url: "https://fred.stlouisfed.org/series/APU0000708111", source: "FRED" },
            "Milk": { url: "https://fred.stlouisfed.org/series/APU0000709112", source: "FRED" },
            "Bread": { url: "https://fred.stlouisfed.org/series/APU0000702111", source: "FRED" },
            "Boneless Chicken": { url: "https://fred.stlouisfed.org/series/APU0000706111", source: "FRED" },
            "Beef": { url: "https://fred.stlouisfed.org/series/APU0000703112", source: "FRED" },
            "Bacon": { url: "https://fred.stlouisfed.org/series/APU0000704111", source: "FRED" },
            "Coffee": { url: "https://fred.stlouisfed.org/series/APU0000717311", source: "FRED" },
            "Rice per lb": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Flour per lb": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Sugar per lb": { url: "https://fred.stlouisfed.org/series/APU0000715211", source: "FRED" },
            "Tomatoes per lb": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Bananas per lb": { url: "https://fred.stlouisfed.org/series/APU0000711211", source: "FRED" },
            "Potatoes per lb": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Lettuce per lb": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Oranges per lb": { url: "https://fred.stlouisfed.org/series/APU0000711311", source: "FRED" },
            "Cheddar Cheese per lb": { url: "https://fred.stlouisfed.org/series/APU0000710212", source: "FRED" },
            "Cereal": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Potato Chips": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Cooking Oil": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Food Away from Home": { url: "https://fred.stlouisfed.org/series/CUSR0000SEFV", source: "FRED" },
            
            // Utilities
            "Power (per KWH)": { url: "https://fred.stlouisfed.org/series/APU000072610", source: "FRED" },
            "Natural Gas Heat": { url: "https://fred.stlouisfed.org/series/APU000072501", source: "FRED" },
            "Rent": { url: "https://fred.stlouisfed.org/series/CUSR0000SEHA", source: "FRED" },
            "Sewer": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Trash Collection": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Internet": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Streaming/Cable TV": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            
            // Insurance
            "Home Insurance": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Car Insurance": { url: "https://fred.stlouisfed.org/series/CUSR0000SETE01", source: "FRED" },
            "Health Insurance": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            
            // Transportation
            "Gallon of Gas": { url: "https://fred.stlouisfed.org/series/APU00007471A", source: "FRED" },
            "Diesel Gas": { url: "https://fred.stlouisfed.org/series/GASDESW", source: "FRED" },
            "Car Parts": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Used Car": { url: "https://fred.stlouisfed.org/series/CUSR0000SETA02", source: "FRED" },
            "Public Transit Fees": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            
            // Home & Appliances
            "Doors/Windows": { url: "https://www.bls.gov/ppi/", source: "BLS" },
            "HVAC System": { url: "https://www.bls.gov/ppi/", source: "BLS" },
            "Fridge": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Water Heater": { url: "https://www.bls.gov/ppi/", source: "BLS" },
            "Kitchen Appliances": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Furniture": { url: "https://fred.stlouisfed.org/series/CUSR0000SAH3", source: "FRED" },
            "Computer": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            
            // Personal
            "Medical Care": { url: "https://fred.stlouisfed.org/series/CUSR0000SAM", source: "FRED" },
            "Dental Care": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Childcare/Education": { url: "https://fred.stlouisfed.org/series/CUSR0000SAE1", source: "FRED" },
            "Clothing": { url: "https://fred.stlouisfed.org/series/CUSR0000SAA", source: "FRED" },
            "Personal Care": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Cleaning Supplies": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Toilet Paper": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Disposable Diapers": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "First Aid Supplies": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Pet Food": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Lawn Care": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            "Insulin": { url: "https://www.bls.gov/cpi/", source: "BLS" },
            
            // Crash Tracker
            "Unemployment Rate": { url: "https://fred.stlouisfed.org/series/UNRATE", source: "FRED" },
            "FHA Mortgage Delinquency": { url: "https://fred.stlouisfed.org/series/DRSFRMACBS", source: "FRED" },
            "Total Mortgage Delinquency": { url: "https://fred.stlouisfed.org/series/DRSFRMACBS", source: "FRED" },
            "Total Housing Supply": { url: "https://fred.stlouisfed.org/series/ACTLISCOUUS", source: "FRED" },
            "Disposable Income of Homeowners": { url: "https://fred.stlouisfed.org/series/TDSP", source: "FRED" },
            "Foreclosure Rate": { url: "https://www.corelogic.com/intelligence/", source: "CoreLogic" },
            "Business Loan Delinquencies": { url: "https://fred.stlouisfed.org/series/DRBLACBS", source: "FRED" },
            "Delinquency Rate on All Loans": { url: "https://fred.stlouisfed.org/series/DRALACBS", source: "FRED" },
            "Credit Card Delinquencies": { url: "https://fred.stlouisfed.org/series/DRCCLACBS", source: "FRED" },
            "Car Payment Defaults (subprime)": { url: "https://fred.stlouisfed.org/series/DRCLACBS", source: "FRED" },
            "Rental Vacancy Rate": { url: "https://fred.stlouisfed.org/series/RRVRUSQ156N", source: "FRED" },
            "Backdated Yield Curve (12 mo)": { url: "https://fred.stlouisfed.org/series/T10Y2Y", source: "FRED" },
            "Job Openings (JOLTS)": { url: "https://fred.stlouisfed.org/series/JTSJOL", source: "FRED" },
            "Jobless Claims": { url: "https://fred.stlouisfed.org/series/ICSA", source: "FRED" },
            "Financial Stress Index": { url: "https://fred.stlouisfed.org/series/STLFSI4", source: "FRED" },
            
            // Investments
            "Gold": { url: "https://finance.yahoo.com/quote/GC=F", source: "Yahoo" },
            "Silver": { url: "https://finance.yahoo.com/quote/SI=F", source: "Yahoo" },
            "Platinum": { url: "https://finance.yahoo.com/quote/PL=F", source: "Yahoo" },
            "S&P 500": { url: "https://finance.yahoo.com/quote/%5EGSPC", source: "Yahoo" },
            "Dow Jones": { url: "https://finance.yahoo.com/quote/%5EDJI", source: "Yahoo" },
            "VIX (Volatility)": { url: "https://finance.yahoo.com/quote/%5EVIX", source: "Yahoo" },
            "S&P 500": { url: "https://fred.stlouisfed.org/series/SP500", source: "FRED" },
            "Dow Jones": { url: "https://fred.stlouisfed.org/series/DJIA", source: "FRED" },
            "Bitcoin": { url: "https://www.coingecko.com/en/coins/bitcoin", source: "CoinGecko" },
            "Ethereum": { url: "https://www.coingecko.com/en/coins/ethereum", source: "CoinGecko" },
            "XRP": { url: "https://www.coingecko.com/en/coins/ripple", source: "CoinGecko" },
            "Solana": { url: "https://www.coingecko.com/en/coins/solana", source: "CoinGecko" },
            "VIX (Volatility)": { url: "https://fred.stlouisfed.org/series/VIXCLS", source: "FRED" },
            
            // Treasury Yields
            "1 Year": { url: "https://fred.stlouisfed.org/series/DGS1", source: "FRED" },
            "2 Year": { url: "https://fred.stlouisfed.org/series/DGS2", source: "FRED" },
            "5 Year": { url: "https://fred.stlouisfed.org/series/DGS5", source: "FRED" },
            "10 Year": { url: "https://fred.stlouisfed.org/series/DGS10", source: "FRED" },
            "20 Year": { url: "https://fred.stlouisfed.org/series/DGS20", source: "FRED" },
            "30 Year": { url: "https://fred.stlouisfed.org/series/DGS30", source: "FRED" },
            
            // Legislation
            "HR 2945 (US)": { url: "https://www.congress.gov/bill/118th-congress/house-bill/2945", source: "Congress.gov" },
            "HR 2725 (US)": { url: "https://www.congress.gov/bill/118th-congress/house-bill/2725", source: "Congress.gov" },
            "SB 79 (CA)": { url: "https://leginfo.legislature.ca.gov/faces/billNavClient.xhtml?bill_id=202520260SB79", source: "CA Legislature" },
            "S 934 (US)": { url: "https://www.congress.gov/bill/118th-congress/senate-bill/934", source: "Congress.gov" },
            "HR {tbd} (US)": { url: "https://www.congress.gov/", source: "Congress.gov" },
            "HR 2710 (US)": { url: "https://www.congress.gov/bill/118th-congress/house-bill/2710", source: "Congress.gov" },
            
            // Regional Data
            "North East": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/regional-housing-statistics", source: "NAR" },
            "Midwest": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/regional-housing-statistics", source: "NAR" },
            "South": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/regional-housing-statistics", source: "NAR" },
            "West": { url: "https://www.nar.realtor/research-and-statistics/housing-statistics/regional-housing-statistics", source: "NAR" },
        };
        
        // Helper function to create source link
        function getSourceLink(name) {
            const source = DATA_SOURCES[name];
            if (source) {
                return `<a href="${source.url}" target="_blank" rel="noopener noreferrer" class="source-link" title="Source: ${source.source}">${name} <span class="source-badge" data-source="${source.source}">${source.source}</span></a>`;
            }
            return name;
        }
        
        // Helper function to create just the badge
        function getSourceBadge(name) {
            const source = DATA_SOURCES[name];
            if (source) {
                return `<a href="${source.url}" target="_blank" rel="noopener noreferrer" class="source-badge-link" title="View source: ${source.source}"><span class="source-badge" data-source="${source.source}">${source.source}</span></a>`;
            }
            return '';
        }

        // --- DATA FETCHING UTILITIES ---
        
        // Simple in-memory cache
        const dataCache = {};
        
        function getCachedData(key) {
            const cached = dataCache[key];
            if (cached && Date.now() - cached.timestamp < CONFIG.CACHE_DURATION) {
                return cached.data;
            }
            return null;
        }
        
        function setCachedData(key, data) {
            dataCache[key] = { data, timestamp: Date.now() };
        }

        // Fetch from FRED API
        async function fetchFromFRED(seriesId) {
            try {
                const url = `https://api.stlouisfed.org/fred/series/observations?series_id=${seriesId}&api_key=${CONFIG.FRED_API_KEY}&file_type=json&sort_order=desc&limit=2`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`FRED API error: ${response.status}`);
                const data = await response.json();
                if (data.observations && data.observations.length > 0) {
                    return {
                        current: parseFloat(data.observations[0].value),
                        previous: data.observations[1] ? parseFloat(data.observations[1].value) : null,
                        date: data.observations[0].date,
                        source: 'FRED'
                    };
                }
                throw new Error('No data from FRED');
            } catch (error) {
                console.warn(`FRED fetch failed for ${seriesId}:`, error.message);
                return null;
            }
        }

        // Fetch from Google Sheets (CSV export)
        async function fetchFromGoogleSheets(gid = '1528334158') {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${CONFIG.GOOGLE_SHEET_ID}/export?format=csv&gid=${gid}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Google Sheets error: ${response.status}`);
                const csvText = await response.text();
                return { data: parseCSV(csvText), source: 'GoogleSheets' };
            } catch (error) {
                console.warn('Google Sheets fetch failed:', error.message);
                return null;
            }
        }

        // Parse CSV to array of objects
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            for (let i = 0; i < lines.length; i++) {
                const cells = lines[i].split(',').map(cell => cell.trim().replace(/^"|"$/g, ''));
                result.push(cells);
            }
            return result;
        }

        // Hybrid fetch: Try FRED first, fallback to Sheets, then hardcoded
        async function fetchLiveData() {
            console.log('üîÑ Fetching live data...');
            const liveData = { source: 'mixed', fredCount: 0, sheetCount: 0, cryptoCount: 0 };
            
            // Fetch FRED data in parallel
            const fredPromises = Object.entries(FRED_SERIES).map(async ([seriesId, key]) => {
                const cached = getCachedData(`fred_${seriesId}`);
                if (cached) {
                    liveData[key] = cached;
                    return;
                }
                
                const data = await fetchFromFRED(seriesId);
                if (data) {
                    liveData[key] = data;
                    liveData.fredCount++;
                    setCachedData(`fred_${seriesId}`, data);
                }
            });
            
            // Fetch crypto prices
            const cryptoPromise = fetchCryptoPrices();
            
            // Fetch Yahoo Finance data (metals, indices, VIX)
            const yahooPromise = fetchYahooFinance();
            
            await Promise.all([...fredPromises, 
                cryptoPromise.then(data => {
                    if (data) {
                        liveData.crypto = data;
                        liveData.cryptoCount = 4;
                    }
                }),
                yahooPromise.then(data => {
                    if (data) {
                        liveData.yahoo = data;
                        liveData.yahooCount = Object.keys(data).length;
                    }
                })
            ]);
            
            // Try Google Sheets as supplementary source
            const sheetsData = await fetchFromGoogleSheets();
            if (sheetsData) {
                liveData.sheets = sheetsData.data;
                liveData.sheetCount = 1;
            }
            
            console.log(`‚úÖ Live data fetched: ${liveData.fredCount} FRED, ${liveData.cryptoCount} crypto, ${liveData.yahooCount || 0} Yahoo, ${liveData.sheetCount} sheet`);
            return liveData;
        }

        // Helper function to parse numeric value from formatted string
        function parseNumericValue(str) {
            if (typeof str === 'number') return str;
            if (!str) return null;
            // Remove $, %, commas, and other non-numeric chars except . and -
            const cleaned = str.replace(/[$,%KMB\s]/gi, '').replace(/,/g, '');
            const num = parseFloat(cleaned);
            return isNaN(num) ? null : num;
        }

        // Helper function to recalculate pctChange and totalChange based on start and current values
        function recalculateChanges(item) {
            const currentVal = parseNumericValue(item.current);
            const startVal = parseNumericValue(item.start);
            
            if (currentVal === null || startVal === null || startVal === 0) return;
            
            // Calculate percentage change: ((current - start) / start) * 100
            const pctChange = ((currentVal - startVal) / Math.abs(startVal)) * 100;
            const totalChange = currentVal - startVal;
            
            // Format percentage change
            const sign = pctChange >= 0 ? '+' : '';
            item.pctChange = sign + pctChange.toFixed(1) + '%';
            
            // Format total change based on whether it's a currency, percentage, or plain number
            if (item.current.includes('$')) {
                // Currency format
                const dollarSign = totalChange >= 0 ? '+$' : '-$';
                item.totalChange = dollarSign + Math.abs(totalChange).toLocaleString(undefined, { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                });
            } else if (item.current.includes('%')) {
                // Rate/percentage format (like mortgage rate)
                const rateSign = totalChange >= 0 ? '+' : '';
                item.totalChange = rateSign + totalChange.toFixed(2);
            } else {
                // Plain number format
                const numSign = totalChange >= 0 ? '+' : '';
                if (Math.abs(totalChange) >= 1000) {
                    item.totalChange = numSign + totalChange.toLocaleString(undefined, { maximumFractionDigits: 0 });
                } else {
                    item.totalChange = numSign + totalChange.toFixed(2);
                }
            }
            
            // Update status/trend based on direction
            if (item.status !== undefined) {
                if (Math.abs(pctChange) < 1) {
                    item.status = 'Stable';
                } else if (pctChange > 0) {
                    item.status = Math.abs(pctChange) > 10 ? 'MAJOR Rise' : 'Rise';
                } else {
                    item.status = Math.abs(pctChange) > 10 ? 'MAJOR Drop' : 'Drop';
                }
            }
            if (item.trend !== undefined) {
                if (Math.abs(pctChange) < 1) {
                    item.trend = 'Stable';
                } else if (pctChange > 0) {
                    item.trend = Math.abs(pctChange) > 10 ? 'MAJOR Rise' : 'Rise';
                } else {
                    item.trend = Math.abs(pctChange) > 10 ? 'MAJOR Drop' : 'Drop';
                }
            }
        }

        // Update dashboardData with live values
        function updateDashboardWithLiveData(liveData) {
            const now = new Date();
            dashboardData.lastUpdated = now.toLocaleDateString() + ' ' + now.toLocaleTimeString() + ' (Live)';
            
            // Update mortgage metrics with FRED data
            if (liveData.mortgageRate) {
                const metric = dashboardData.mortgageMetrics.find(m => m.name === 'Mortgage Rate');
                if (metric) {
                    metric.current = liveData.mortgageRate.current.toFixed(2) + '%';
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            if (liveData.fedRate) {
                const metric = dashboardData.mortgageMetrics.find(m => m.name === 'Fed Rate');
                if (metric) {
                    metric.current = liveData.fedRate.current.toFixed(2) + '%';
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            if (liveData.treasury10yr) {
                const metric = dashboardData.mortgageMetrics.find(m => m.name === '10 Year Treasury Yield');
                if (metric) {
                    metric.current = liveData.treasury10yr.current.toFixed(2) + '%';
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            // Update treasury yields
            const yieldMap = {
                treasury1yr: '1 Year',
                treasury2yr: '2 Year', 
                treasury5yr: '5 Year',
                treasury10yr: '10 Year',
                treasury20yr: '20 Year',
                treasury30yr: '30 Year'
            };
            
            Object.entries(yieldMap).forEach(([key, term]) => {
                if (liveData[key]) {
                    const yieldItem = dashboardData.treasuryYields.find(y => y.term === term);
                    if (yieldItem) {
                        yieldItem.rate = liveData[key].current.toFixed(2) + '%';
                        yieldItem.liveSource = 'FRED';
                    }
                }
            });
            
            // Update crash factors
            if (liveData.unemploymentRate) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Unemployment Rate');
                if (factor) {
                    factor.value = liveData.unemploymentRate.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.jobOpenings) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Job Openings (JOLTS)');
                if (factor) {
                    factor.value = (liveData.jobOpenings.current / 1000).toFixed(0) + 'K';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.joblessClaims) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Jobless Claims');
                if (factor) {
                    factor.value = liveData.joblessClaims.current.toLocaleString();
                    factor.risk = 'Low';
                    factor.color = 'green';
                    factor.liveSource = 'FRED';
                }
            }
            
            // NEW: Update more crash factors with FRED data
            if (liveData.mortgageDelinquency) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Total Mortgage Delinquency');
                if (factor) {
                    factor.value = liveData.mortgageDelinquency.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.creditCardDelinquency) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Credit Card Delinquencies');
                if (factor) {
                    factor.value = liveData.creditCardDelinquency.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.businessLoanDelinquency) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Business Loan Delinquencies');
                if (factor) {
                    factor.value = liveData.businessLoanDelinquency.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.allLoansDelinquency) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Delinquency Rate on All Loans');
                if (factor) {
                    factor.value = liveData.allLoansDelinquency.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.rentalVacancy) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Rental Vacancy Rate');
                if (factor) {
                    factor.value = liveData.rentalVacancy.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.yieldCurve) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Backdated Yield Curve (12 mo)');
                if (factor) {
                    factor.value = liveData.yieldCurve.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.financialStress) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Financial Stress Index');
                if (factor) {
                    factor.value = liveData.financialStress.current.toFixed(2);
                    // Classify risk based on stress index value
                    if (liveData.financialStress.current < 0) {
                        factor.risk = 'Low';
                        factor.color = 'green';
                    } else if (liveData.financialStress.current < 1) {
                        factor.risk = 'Moderate';
                        factor.color = 'yellow';
                    } else {
                        factor.risk = 'Elevated';
                        factor.color = 'orange';
                    }
                    factor.liveSource = 'FRED';
                }
            }
            
            if (liveData.debtServiceRatio) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Disposable Income of Homeowners');
                if (factor) {
                    factor.value = liveData.debtServiceRatio.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            // Update Total Housing Supply in crash tracker
            if (liveData.totalHomesForSale) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Total Housing Supply');
                if (factor) {
                    factor.value = liveData.totalHomesForSale.current.toLocaleString();
                    factor.liveSource = 'FRED';
                }
            }
            
            // NEW: Update food prices
            if (liveData.eggPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Eggs');
                if (item) {
                    item.current = '$' + liveData.eggPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.milkPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Milk');
                if (item) {
                    item.current = '$' + liveData.milkPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.breadPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Bread');
                if (item) {
                    item.current = '$' + liveData.breadPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.coffeePrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Coffee');
                if (item) {
                    item.current = '$' + liveData.coffeePrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.bananaPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Bananas per lb');
                if (item) {
                    item.current = '$' + liveData.bananaPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // More food prices
            if (liveData.beefPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Beef');
                if (item) {
                    item.current = '$' + liveData.beefPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.baconPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Bacon');
                if (item) {
                    item.current = '$' + liveData.baconPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.chickenPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Boneless Chicken');
                if (item) {
                    item.current = '$' + liveData.chickenPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.sugarPrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Sugar per lb');
                if (item) {
                    item.current = '$' + liveData.sugarPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.orangePrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Oranges per lb');
                if (item) {
                    item.current = '$' + liveData.orangePrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.cheesePrice) {
                const item = dashboardData.foodExpenses.find(f => f.name === 'Cheddar Cheese per lb');
                if (item) {
                    item.current = '$' + liveData.cheesePrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Energy & Utilities
            if (liveData.gasPrice) {
                const item = dashboardData.transportExpenses.find(f => f.name === 'Gallon of Gas');
                if (item) {
                    item.current = '$' + liveData.gasPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.dieselPrice) {
                const item = dashboardData.transportExpenses.find(f => f.name === 'Diesel Gas');
                if (item) {
                    item.current = '$' + liveData.dieselPrice.current.toFixed(3);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.electricityPrice) {
                const item = dashboardData.utilitiesExpenses.find(f => f.name === 'Power (per KWH)');
                if (item) {
                    item.current = '$' + liveData.electricityPrice.current.toFixed(3);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.natGasPrice) {
                const item = dashboardData.utilitiesExpenses.find(f => f.name === 'Natural Gas Heat');
                if (item) {
                    item.current = '$' + liveData.natGasPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Housing Supply
            if (liveData.totalHomesForSale) {
                const metric = dashboardData.supplyMetrics.find(m => m.name === 'Total Homes for Sale');
                if (metric) {
                    metric.current = liveData.totalHomesForSale.current.toLocaleString();
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            if (liveData.newHomesForSale) {
                const metric = dashboardData.supplyMetrics.find(m => m.name === 'New Construction for Sale');
                if (metric) {
                    metric.current = (liveData.newHomesForSale.current * 1000).toLocaleString();
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            if (liveData.medianHomePrice) {
                const metric = dashboardData.homeMetrics.find(m => m.name === 'Resale Home (Median)');
                if (metric) {
                    metric.current = '$' + liveData.medianHomePrice.current.toLocaleString();
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            // Auto loan delinquency for crash tracker
            if (liveData.autoLoanDelinquency) {
                const factor = dashboardData.crashFactors.find(f => f.name === 'Car Payment Defaults (subprime)');
                if (factor) {
                    factor.value = liveData.autoLoanDelinquency.current.toFixed(2) + '%';
                    factor.liveSource = 'FRED';
                }
            }
            
            // Builder Materials
            if (liveData.lumberPrice) {
                const item = dashboardData.builderExpenses.find(f => f.name === 'Softwood Lumber');
                if (item) {
                    item.current = '$' + liveData.lumberPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.steelPrice) {
                const item = dashboardData.builderExpenses.find(f => f.name === 'Steel');
                if (item) {
                    item.current = '$' + liveData.steelPrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            if (liveData.concretePrice) {
                const item = dashboardData.builderExpenses.find(f => f.name === 'Concrete');
                if (item) {
                    item.current = '$' + liveData.concretePrice.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Stock Market
            if (liveData.sp500) {
                const investment = dashboardData.investments.find(i => i.name === 'S&P 500');
                if (investment) {
                    investment.value = '$' + liveData.sp500.current.toLocaleString(undefined, { maximumFractionDigits: 0 });
                    investment.liveSource = 'FRED';
                }
            }
            
            if (liveData.dowJones) {
                const investment = dashboardData.investments.find(i => i.name === 'Dow Jones');
                if (investment) {
                    investment.value = '$' + liveData.dowJones.current.toLocaleString(undefined, { maximumFractionDigits: 0 });
                    investment.liveSource = 'FRED';
                }
            }
            
            if (liveData.buildingPermits) {
                const metric = dashboardData.supplyMetrics.find(m => m.name === 'Building Permits');
                if (metric) {
                    metric.current = (liveData.buildingPermits.current * 1000).toLocaleString();
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            // Core Inflation for mortgage metrics
            if (liveData.coreInflation) {
                const metric = dashboardData.mortgageMetrics.find(m => m.name === 'Core Inflation Y.O.Y.');
                if (metric) {
                    // Calculate YoY change from CPI index
                    metric.current = liveData.coreInflation.current.toFixed(1) + '%';
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            // Median Household Income
            if (liveData.medianIncome) {
                const metric = dashboardData.affordabilityMetrics.find(m => m.name === 'Median Household Income');
                if (metric) {
                    metric.current = '$' + liveData.medianIncome.current.toLocaleString();
                    metric.liveSource = 'FRED';
                    recalculateChanges(metric);
                }
            }
            
            // Insurance - Car Insurance (CPI to approx price)
            if (liveData.carInsuranceCPI) {
                const item = dashboardData.insuranceExpenses.find(f => f.name === 'Car Insurance');
                if (item) {
                    // CPI index - convert to approximate monthly cost
                    item.current = '$' + (liveData.carInsuranceCPI.current * 0.85).toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Medical Care
            if (liveData.medicalCareCPI) {
                const item = dashboardData.personalExpenses.find(f => f.name === 'Medical Care');
                if (item) {
                    item.current = '$' + liveData.medicalCareCPI.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Rent CPI
            if (liveData.rentCPI) {
                const item = dashboardData.utilitiesExpenses.find(f => f.name === 'Rent');
                if (item) {
                    item.current = '$' + liveData.rentCPI.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Clothing/Apparel
            if (liveData.apparelCPI) {
                const item = dashboardData.personalExpenses.find(f => f.name === 'Clothing');
                if (item) {
                    item.current = '$' + liveData.apparelCPI.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Education/Childcare
            if (liveData.educationCPI) {
                const item = dashboardData.personalExpenses.find(f => f.name === 'Childcare/Education');
                if (item) {
                    item.current = '$' + liveData.educationCPI.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Furniture
            if (liveData.furnitureCPI) {
                const item = dashboardData.homeAppliancesExpenses.find(f => f.name === 'Furniture');
                if (item) {
                    item.current = '$' + liveData.furnitureCPI.current.toFixed(2);
                    item.liveSource = 'FRED';
                    recalculateChanges(item);
                }
            }
            
            // Update crypto prices from CoinGecko
            if (liveData.crypto) {
                const cryptoMap = {
                    bitcoin: 'Bitcoin',
                    ethereum: 'Ethereum',
                    xrp: 'XRP',
                    solana: 'Solana'
                };
                
                Object.entries(cryptoMap).forEach(([key, name]) => {
                    const cryptoData = liveData.crypto[key];
                    if (cryptoData && cryptoData.price) {
                        let investment = dashboardData.investments.find(i => i.name === name);
                        // Add Solana if not in list
                        if (!investment && name === 'Solana') {
                            dashboardData.investments.push({
                                name: name,
                                value: '$0',
                                momChange: '0%',
                                yoyChange: 'N/A'
                            });
                            investment = dashboardData.investments.find(i => i.name === name);
                        }
                        if (investment) {
                            investment.value = '$' + cryptoData.price.toLocaleString(undefined, { maximumFractionDigits: 2 });
                            if (cryptoData.change24h !== undefined) {
                                const change = cryptoData.change24h.toFixed(1);
                                investment.momChange = (change >= 0 ? '+' : '') + change + '%';
                            }
                            investment.liveSource = 'CoinGecko';
                        }
                    }
                });
            }
            
            // Update from Yahoo Finance (metals, indices, VIX)
            if (liveData.yahoo) {
                // Gold
                if (liveData.yahoo.gold) {
                    const investment = dashboardData.investments.find(i => i.name === 'Gold');
                    if (investment) {
                        investment.value = '$' + liveData.yahoo.gold.current.toLocaleString(undefined, { maximumFractionDigits: 2 });
                        if (liveData.yahoo.gold.changePercent !== undefined) {
                            investment.momChange = (liveData.yahoo.gold.changePercent >= 0 ? '+' : '') + liveData.yahoo.gold.changePercent.toFixed(1) + '%';
                        }
                        investment.liveSource = 'Yahoo';
                    }
                }
                
                // Silver
                if (liveData.yahoo.silver) {
                    const investment = dashboardData.investments.find(i => i.name === 'Silver');
                    if (investment) {
                        investment.value = '$' + liveData.yahoo.silver.current.toLocaleString(undefined, { maximumFractionDigits: 2 });
                        if (liveData.yahoo.silver.changePercent !== undefined) {
                            investment.momChange = (liveData.yahoo.silver.changePercent >= 0 ? '+' : '') + liveData.yahoo.silver.changePercent.toFixed(1) + '%';
                        }
                        investment.liveSource = 'Yahoo';
                    }
                }
                
                // Platinum
                if (liveData.yahoo.platinum) {
                    let investment = dashboardData.investments.find(i => i.name === 'Platinum');
                    if (!investment) {
                        dashboardData.investments.splice(2, 0, {
                            name: 'Platinum',
                            value: '$0',
                            momChange: '0%',
                            yoyChange: 'N/A'
                        });
                        investment = dashboardData.investments.find(i => i.name === 'Platinum');
                    }
                    if (investment) {
                        investment.value = '$' + liveData.yahoo.platinum.current.toLocaleString(undefined, { maximumFractionDigits: 2 });
                        if (liveData.yahoo.platinum.changePercent !== undefined) {
                            investment.momChange = (liveData.yahoo.platinum.changePercent >= 0 ? '+' : '') + liveData.yahoo.platinum.changePercent.toFixed(1) + '%';
                        }
                        investment.liveSource = 'Yahoo';
                    }
                }
                
                // S&P 500
                if (liveData.yahoo.sp500) {
                    const investment = dashboardData.investments.find(i => i.name === 'S&P 500');
                    if (investment) {
                        investment.value = '$' + liveData.yahoo.sp500.current.toLocaleString(undefined, { maximumFractionDigits: 2 });
                        if (liveData.yahoo.sp500.changePercent !== undefined) {
                            investment.momChange = (liveData.yahoo.sp500.changePercent >= 0 ? '+' : '') + liveData.yahoo.sp500.changePercent.toFixed(1) + '%';
                        }
                        investment.liveSource = 'Yahoo';
                    }
                }
                
                // Dow Jones
                if (liveData.yahoo.dowJones) {
                    const investment = dashboardData.investments.find(i => i.name === 'Dow Jones');
                    if (investment) {
                        investment.value = '$' + liveData.yahoo.dowJones.current.toLocaleString(undefined, { maximumFractionDigits: 2 });
                        if (liveData.yahoo.dowJones.changePercent !== undefined) {
                            investment.momChange = (liveData.yahoo.dowJones.changePercent >= 0 ? '+' : '') + liveData.yahoo.dowJones.changePercent.toFixed(1) + '%';
                        }
                        investment.liveSource = 'Yahoo';
                    }
                }
                
                // VIX
                if (liveData.yahoo.vix) {
                    let vixInvestment = dashboardData.investments.find(i => i.name === 'VIX (Volatility)');
                    if (!vixInvestment) {
                        dashboardData.investments.push({
                            name: 'VIX (Volatility)',
                            value: '0',
                            momChange: 'N/A',
                            yoyChange: 'N/A'
                        });
                        vixInvestment = dashboardData.investments.find(i => i.name === 'VIX (Volatility)');
                    }
                    if (vixInvestment) {
                        vixInvestment.value = liveData.yahoo.vix.current.toFixed(2);
                        if (liveData.yahoo.vix.changePercent !== undefined) {
                            vixInvestment.momChange = (liveData.yahoo.vix.changePercent >= 0 ? '+' : '') + liveData.yahoo.vix.changePercent.toFixed(1) + '%';
                        }
                        vixInvestment.liveSource = 'Yahoo';
                    }
                }
            }
            
            console.log('üìä Dashboard updated with live data');
        }

        // --- STATIC DATA (Fallback) ---
        const dashboardData = {
            lastUpdated: "12/15/2025 09:26 AM EST",
            scores: [
                {
                    title: "Housing Health Score",
                    value: 53.1,
                    range: "red",
                    statusText: "Affordability Crisis"
                },
                {
                    title: "Supply Score",
                    value: 46.90,
                    range: "orange",
                    statusText: "Tight Market"
                },
                {
                    title: "Affordability Score",
                    value: 45.24,
                    range: "orange",
                    statusText: "Very Strained"
                },
                {
                    title: "Crash Likelihood",
                    value: 24.75,
                    range: "green",
                    statusText: "Nowhere Close"
                }
            ],
            // HOUSING METRICS
            homeMetrics: [
                { name: "Resale Home (Median)", target: "$385,000", current: "$415,200", start: "$393,400", pctChange: "+5.5%", totalChange: "+$21,800", status: "Rise" },
                { name: "New Construction (Median)", target: "$401,800", current: "$413,500", start: "$427,900", pctChange: "-3.4%", totalChange: "-$14,400", status: "Drop" },
                { name: "Affordable Home (Median)", target: "$310,000", current: "$362,800", start: "$348,600", pctChange: "+4.1%", totalChange: "+$14,200", status: "Rise" }
            ],
            mortgageMetrics: [
                { name: "Mortgage Rate", target: "6.72%", current: "6.22%", start: "7.07%", pctChange: "-12.0%", totalChange: "-0.85", status: "Drop" },
                { name: "Fed Rate", target: "4.33%", current: "3.88%", start: "4.33%", pctChange: "-10.4%", totalChange: "-0.45", status: "Drop" },
                { name: "10 Year Treasury Yield", target: "4.39%", current: "4.14%", start: "4.623%", pctChange: "-10.4%", totalChange: "-0.48", status: "Drop" },
                { name: "Core Inflation Y.O.Y.", target: "3.29%", current: "3.33%", start: "3.63%", pctChange: "-8.4%", totalChange: "-0.30", status: "Drop" },
                { name: "Median Mortgage p/month", target: "$2,250", current: "$2,649", start: "$2,705", pctChange: "-2.1%", totalChange: "-$56.25", status: "Drop" }
            ],
            affordabilityMetrics: [
                { name: "FTHB Affordability Index", target: "95", current: "64.6", start: "66.8", pctChange: "-3.3%", totalChange: "-3.29%", status: "Drop" },
                { name: "Housing Affordability Index", target: "125", current: "106.2", start: "100.7", pctChange: "+5.5%", totalChange: "+5.46%", status: "Rise" },
                { name: "Median Household Income", target: "$80,610", current: "$83,730", start: "$80,610", pctChange: "+3.9%", totalChange: "+$3,120", status: "Rise" }
            ],
            supplyMetrics: [
                { name: "Total Homes for Sale", target: "2,502,500", current: "1,072,417", start: "829,376", pctChange: "+29.3%", totalChange: "+243,041", status: "Rise" },
                { name: "New Construction for Sale", target: "550,000", current: "490,000", start: "496,000", pctChange: "-1.2%", totalChange: "-6,000", status: "Drop" },
                { name: "Resale Homes for Sale", target: "2,000,500", current: "582,417", start: "333,376", pctChange: "+74.7%", totalChange: "+249,041", status: "Rise" },
                { name: "Building Permits", target: "1,850,000", current: "1,330,000", start: "1,456,000", pctChange: "-8.7%", totalChange: "-126,000", status: "Drop" }
            ],
            // COST TRACKERS - Builder Expenses
            builderExpenses: [
                { name: "Softwood Lumber", current: "$252.74", start: "$267.54", pctChange: "-5.5%", totalChange: "-$14.81", trend: "Drop" },
                { name: "Steel", current: "$143.25", start: "$131.69", pctChange: "+8.8%", totalChange: "+$11.56", trend: "Rise" },
                { name: "Shingles", current: "$369.26", start: "$359.22", pctChange: "+2.8%", totalChange: "+$10.04", trend: "Rise" },
                { name: "Plumbing", current: "$463.87", start: "$421.34", pctChange: "+10.1%", totalChange: "+$42.53", trend: "MAJOR Rise" },
                { name: "Concrete", current: "$252.99", start: "$251.22", pctChange: "+0.7%", totalChange: "+$1.77", trend: "Stable" }
            ],
            // Household Expenses - Utilities & Housing
            utilitiesExpenses: [
                { name: "Power (per KWH)", current: "$0.188", start: "$0.179", pctChange: "+5.0%", totalChange: "+$0.01", trend: "Rise" },
                { name: "Natural Gas Heat", current: "$1.61", start: "$1.55", pctChange: "+3.9%", totalChange: "+$0.06", trend: "Rise" },
                { name: "Rent", current: "$438.32", start: "$429.02", pctChange: "+2.2%", totalChange: "+$9.31", trend: "Rise" },
                { name: "Sewer", current: "$319.87", start: "$310.23", pctChange: "+3.1%", totalChange: "+$9.64", trend: "Rise" },
                { name: "Trash Collection", current: "$204.97", start: "$194.67", pctChange: "+5.3%", totalChange: "+$10.30", trend: "Rise" },
                { name: "Internet", current: "$67.72", start: "$67.76", pctChange: "-0.1%", totalChange: "-$0.04", trend: "Stable" },
                { name: "Streaming/Cable TV", current: "$593.93", start: "$595.02", pctChange: "-0.2%", totalChange: "-$1.10", trend: "Stable" }
            ],
            // Household Expenses - Insurance
            insuranceExpenses: [
                { name: "Home Insurance", current: "$266.31", start: "$260.75", pctChange: "+2.1%", totalChange: "+$5.56", trend: "Rise" },
                { name: "Car Insurance", current: "$222.47", start: "$218.25", pctChange: "+1.9%", totalChange: "+$4.22", trend: "Rise" },
                { name: "Health Insurance", current: "$163.88", start: "$160.49", pctChange: "+2.1%", totalChange: "+$3.40", trend: "Rise" }
            ],
            // Household Expenses - Food & Groceries
            foodExpenses: [
                { name: "Food Overall", current: "$342.05", start: "$335.67", pctChange: "+1.9%", totalChange: "+$6.38", trend: "Rise" },
                { name: "Eggs", current: "$3.49", start: "$4.95", pctChange: "-29.5%", totalChange: "-$1.46", trend: "MAJOR Drop" },
                { name: "Milk", current: "$4.13", start: "$4.03", pctChange: "+2.5%", totalChange: "+$0.10", trend: "Rise" },
                { name: "Bread", current: "$1.87", start: "$1.93", pctChange: "-3.3%", totalChange: "-$0.06", trend: "Drop" },
                { name: "Boneless Chicken", current: "$4.17", start: "$3.97", pctChange: "+5.1%", totalChange: "+$0.20", trend: "Rise" },
                { name: "Beef", current: "$6.32", start: "$5.54", pctChange: "+14.1%", totalChange: "+$0.78", trend: "MAJOR Rise" },
                { name: "Bacon", current: "$7.29", start: "$7.04", pctChange: "+3.5%", totalChange: "+$0.25", trend: "Rise" },
                { name: "Coffee", current: "$9.14", start: "$7.01", pctChange: "+30.4%", totalChange: "+$2.13", trend: "MAJOR Rise" },
                { name: "Rice per lb", current: "$1.06", start: "$1.01", pctChange: "+5.2%", totalChange: "+$0.05", trend: "Rise" },
                { name: "Flour per lb", current: "$0.563", start: "$0.560", pctChange: "+0.5%", totalChange: "+$0.00", trend: "Stable" },
                { name: "Sugar per lb", current: "$1.04", start: "$1.01", pctChange: "+3.1%", totalChange: "+$0.03", trend: "Rise" },
                { name: "Tomatoes per lb", current: "$1.91", start: "$2.05", pctChange: "-6.8%", totalChange: "-$0.14", trend: "Drop" },
                { name: "Bananas per lb", current: "$0.67", start: "$0.62", pctChange: "+8.1%", totalChange: "+$0.05", trend: "Rise" },
                { name: "Potatoes per lb", current: "$1.01", start: "$0.97", pctChange: "+4.2%", totalChange: "+$0.04", trend: "Rise" },
                { name: "Lettuce per lb", current: "$3.01", start: "$2.83", pctChange: "+6.2%", totalChange: "+$0.18", trend: "Rise" },
                { name: "Oranges per lb", current: "$1.80", start: "$1.53", pctChange: "+17.8%", totalChange: "+$0.27", trend: "MAJOR Rise" },
                { name: "Cheddar Cheese per lb", current: "$6.05", start: "$5.70", pctChange: "+6.2%", totalChange: "+$0.35", trend: "Rise" },
                { name: "Cereal", current: "$361.54", start: "$356.88", pctChange: "+1.3%", totalChange: "+$4.66", trend: "Rise" },
                { name: "Potato Chips", current: "$6.97", start: "$6.47", pctChange: "+7.7%", totalChange: "+$0.50", trend: "Rise" },
                { name: "Cooking Oil", current: "$118.52", start: "$117.38", pctChange: "+1.0%", totalChange: "+$1.14", trend: "Stable" },
                { name: "Food Away from Home", current: "$385.45", start: "$375.53", pctChange: "+2.6%", totalChange: "+$9.92", trend: "Rise" }
            ],
            // Household Expenses - Transportation
            transportExpenses: [
                { name: "Gallon of Gas", current: "$3.39", start: "$3.21", pctChange: "+5.6%", totalChange: "+$0.18", trend: "Rise" },
                { name: "Diesel Gas", current: "$3.665", start: "$3.666", pctChange: "0.0%", totalChange: "+$0.00", trend: "Stable" },
                { name: "Car Parts", current: "$188.03", start: "$182.98", pctChange: "+2.8%", totalChange: "+$5.05", trend: "Rise" },
                { name: "Used Car", current: "$184.57", start: "$185.43", pctChange: "-0.5%", totalChange: "-$0.86", trend: "Stable" },
                { name: "Public Transit Fees", current: "$259.20", start: "$264.66", pctChange: "-2.1%", totalChange: "-$5.46", trend: "Drop" }
            ],
            // Household Expenses - Home & Appliances
            homeAppliancesExpenses: [
                { name: "Doors/Windows", current: "$473.06", start: "$429.67", pctChange: "+10.1%", totalChange: "+$43.39", trend: "MAJOR Rise" },
                { name: "HVAC System", current: "$233.06", start: "$222.50", pctChange: "+4.7%", totalChange: "+$10.56", trend: "Rise" },
                { name: "Fridge", current: "$134.75", start: "$132.62", pctChange: "+1.6%", totalChange: "+$2.13", trend: "Rise" },
                { name: "Water Heater", current: "$641.38", start: "$591.49", pctChange: "+8.4%", totalChange: "+$49.89", trend: "Rise" },
                { name: "Kitchen Appliances", current: "$158.76", start: "$153.03", pctChange: "+3.7%", totalChange: "+$5.73", trend: "Rise" },
                { name: "Furniture", current: "$154.02", start: "$148.30", pctChange: "+3.9%", totalChange: "+$5.72", trend: "Rise" },
                { name: "Computer", current: "$106.84", start: "$104.24", pctChange: "+2.5%", totalChange: "+$2.60", trend: "Rise" }
            ],
            // Household Expenses - Personal & Other
            personalExpenses: [
                { name: "Medical Care", current: "$585.10", start: "$571.23", pctChange: "+2.4%", totalChange: "+$13.86", trend: "Rise" },
                { name: "Dental Care", current: "$140.92", start: "$139.37", pctChange: "+1.1%", totalChange: "+$1.55", trend: "Rise" },
                { name: "Childcare/Education", current: "$897.30", start: "$879.54", pctChange: "+2.0%", totalChange: "+$17.76", trend: "Rise" },
                { name: "Clothing", current: "$132.59", start: "$128.18", pctChange: "+3.4%", totalChange: "+$4.41", trend: "Rise" },
                { name: "Personal Care", current: "$362.97", start: "$351.74", pctChange: "+3.2%", totalChange: "+$11.23", trend: "Rise" },
                { name: "Cleaning Supplies", current: "$236.13", start: "$223.27", pctChange: "+5.8%", totalChange: "+$12.87", trend: "Rise" },
                { name: "Toilet Paper", current: "$150.87", start: "$144.93", pctChange: "+4.1%", totalChange: "+$5.94", trend: "Rise" },
                { name: "Disposable Diapers", current: "$106.13", start: "$104.95", pctChange: "+1.1%", totalChange: "+$1.18", trend: "Rise" },
                { name: "First Aid Supplies", current: "$208.53", start: "$207.24", pctChange: "+0.6%", totalChange: "+$1.29", trend: "Stable" },
                { name: "Pet Food", current: "$191.49", start: "$189.82", pctChange: "+0.9%", totalChange: "+$1.67", trend: "Stable" },
                { name: "Lawn Care", current: "$162.95", start: "$162.46", pctChange: "+0.3%", totalChange: "+$0.49", trend: "Stable" },
                { name: "Insulin", current: "$269.20", start: "$269.25", pctChange: "0.0%", totalChange: "-$0.05", trend: "Stable" }
            ],
            // LEGISLATION
            legislation: [
                { id: "HR 2945 (US)", name: "Housing for All Act", status: "Currently at committee lvl" },
                { id: "HR 2725 (US)", name: "Affordable Housing Credit Improvement", status: "Ways & Means committee" },
                { id: "SB 79 (CA)", name: "Transit-Oriented Housing", status: "Senate Finance Committee" },
                { id: "S 934 (US)", name: "Senate Finance Committee", status: "Senate Finance Committee" },
                { id: "HR {tbd} (US)", name: "No tax on home sales act", status: "Recently Introduced" },
                { id: "HR 2710 (US)", name: "People over parking act", status: "Recently Introduced" }
            ],
            // CRASH TRACKER - All 15 variables
            crashFactors: [
                { name: "Unemployment Rate", category: "Critical", value: "4.40%", points: 3, risk: "Moderate", color: "yellow" },
                { name: "FHA Mortgage Delinquency", category: "Critical", value: "4.10%", points: 0, risk: "Low", color: "green" },
                { name: "Total Mortgage Delinquency", category: "Critical", value: "1.78%", points: 0, risk: "Low", color: "green" },
                { name: "Total Housing Supply", category: "Critical", value: "1,072,417", points: 0, risk: "Low", color: "green" },
                { name: "Disposable Income of Homeowners", category: "Major", value: "11.25%", points: 2, risk: "Low", color: "green" },
                { name: "Foreclosure Rate", category: "Major", value: "0.60%", points: 2, risk: "Low", color: "green" },
                { name: "Business Loan Delinquencies", category: "Major", value: "1.33%", points: 2, risk: "Low", color: "green" },
                { name: "Delinquency Rate on All Loans", category: "Major", value: "1.47%", points: 0, risk: "Low", color: "green" },
                { name: "Credit Card Delinquencies", category: "Minor", value: "2.98%", points: 1.5, risk: "Low", color: "green" },
                { name: "Car Payment Defaults (subprime)", category: "Minor", value: "6.30%", points: 6, risk: "Elevated", color: "orange" },
                { name: "Rental Vacancy Rate", category: "Minor", value: "7.10%", points: 3.25, risk: "Moderate", color: "yellow" },
                { name: "Backdated Yield Curve (12 mo)", category: "Critical", value: "0.67%", points: 3, risk: "Moderate", color: "yellow" },
                { name: "Job Openings (JOLTS)", category: "Major", value: "7,670,000", points: 2, risk: "Low", color: "green" },
                { name: "Jobless Claims", category: "TBD", value: "TBD", points: 0, risk: "High", color: "red" },
                { name: "Financial Stress Index", category: "TBD", value: "TBD", points: 0, risk: "High", color: "red" }
            ],
            // REGIONAL AFFORDABILITY
            regionalData: [
                { region: "North East", resaleHome: "$552,100", qualifyingIncome: "$136,368", familyIncome: "$115,443", mortgage: "$2,841", affordability: 92.7, priorMonth: 84.7, lastYear: 95.4, yearlyChange: "-2.8%" },
                { region: "Midwest", resaleHome: "$333,900", qualifyingIncome: "$82,464", familyIncome: "$103,209", mortgage: "$1,718", affordability: 131.9, priorMonth: 125.2, lastYear: 135.7, yearlyChange: "-2.8%" },
                { region: "South", resaleHome: "$371,300", qualifyingIncome: "$91,728", familyIncome: "$98,566", mortgage: "$1,911", affordability: 109.9, priorMonth: 107.5, lastYear: 109.2, yearlyChange: "+0.6%" },
                { region: "West", resaleHome: "$636,600", qualifyingIncome: "$157,248", familyIncome: "$114,661", mortgage: "$3,276", affordability: 75, priorMonth: 72.9, lastYear: 71, yearlyChange: "+5.6%" }
            ],
            // INVESTMENT TRACKER
            investments: [
                { name: "Gold", value: "$395.44", momChange: "+1.9%", yoyChange: "+53.2%" },
                { name: "Silver", value: "$56.10", momChange: "+9.5%", yoyChange: "+95.3%" },
                { name: "Platinum", value: "$1,842", momChange: "+0.5%", yoyChange: "+10.2%" },
                { name: "VIX (Volatility)", value: "16.50", momChange: "+2.1%", yoyChange: "-8.5%" },
                { name: "S&P 500", value: "$6,827", momChange: "-0.3%", yoyChange: "+12.5%" },
                { name: "Dow Jones", value: "$48,417", momChange: "+1.7%", yoyChange: "+8.2%" },
                { name: "Bitcoin", value: "$88,172", momChange: "-3.0%", yoyChange: "-16.3%" },
                { name: "Ethereum", value: "$3,115", momChange: "+2.7%", yoyChange: "0.0%" },
                { name: "XRP", value: "$2.02", momChange: "-7.2%", yoyChange: "-34.0%" }
            ],
            treasuryYields: [
                { term: "1 Year", rate: "3.60%", momChange: "-0.3%", yoyChange: "-13.7%" },
                { term: "2 Year", rate: "3.52%", momChange: "+1.4%", yoyChange: "-16.6%" },
                { term: "5 Year", rate: "3.68%", momChange: "+2.5%", yoyChange: "-15.6%" },
                { term: "10 Year", rate: "4.11%", momChange: "+2.2%", yoyChange: "-10.3%" },
                { term: "20 Year", rate: "4.72%", momChange: "+2.2%", yoyChange: "-3.3%" },
                { term: "30 Year", rate: "4.76%", momChange: "+1.9%", yoyChange: "-1.4%" }
            ],
            // ECONOMIC INDEX HISTORICAL
            economicIndex: [
                { date: "3/31/2019", value: 100.00, momChange: null, momPct: null },
                { date: "6/30/2019", value: 99.33, momChange: -0.67, momPct: "-0.67%" },
                { date: "9/30/2019", value: 100.38, momChange: 1.06, momPct: "+1.07%" },
                { date: "12/31/2019", value: 100.55, momChange: 0.16, momPct: "+0.16%" },
                { date: "3/31/2020", value: 100.89, momChange: 0.34, momPct: "+0.34%" },
                { date: "6/30/2020", value: 103.42, momChange: 2.54, momPct: "+2.51%" },
                { date: "9/30/2020", value: 102.97, momChange: -0.45, momPct: "-0.44%" },
                { date: "12/31/2020", value: 103.78, momChange: 0.80, momPct: "+0.78%" },
                { date: "3/31/2021", value: 104.43, momChange: 0.65, momPct: "+0.63%" },
                { date: "6/30/2021", value: 107.97, momChange: 3.53, momPct: "+3.38%" },
                { date: "9/30/2021", value: 110.91, momChange: 2.94, momPct: "+2.73%" },
                { date: "12/31/2021", value: 113.20, momChange: 2.29, momPct: "+2.06%" },
                { date: "3/31/2022", value: 116.72, momChange: 3.52, momPct: "+3.11%" },
                { date: "6/30/2022", value: 122.81, momChange: 6.09, momPct: "+5.22%" },
                { date: "9/30/2022", value: 126.44, momChange: 3.64, momPct: "+2.96%" },
                { date: "12/31/2022", value: 129.05, momChange: 2.61, momPct: "+2.06%" },
                { date: "3/31/2023", value: 126.80, momChange: -2.26, momPct: "-1.75%" },
                { date: "6/30/2023", value: 124.94, momChange: -1.86, momPct: "-1.47%" },
                { date: "9/30/2023", value: 126.03, momChange: 1.10, momPct: "+0.88%" },
                { date: "12/31/2023", value: 126.46, momChange: 0.42, momPct: "+0.34%" },
                { date: "3/31/2024", value: 127.91, momChange: 1.46, momPct: "+1.15%" },
                { date: "6/30/2024", value: 128.54, momChange: 0.63, momPct: "+0.49%" },
                { date: "9/30/2024", value: 132.03, momChange: 3.49, momPct: "+2.71%" },
                { date: "12/31/2024", value: 132.75, momChange: 0.72, momPct: "+0.54%" },
                { date: "1/31/2025", value: 134.77, momChange: 2.02, momPct: "+1.52%" },
                { date: "2/28/2025", value: 136.62, momChange: 1.86, momPct: "+1.38%" },
                { date: "3/31/2025", value: 137.99, momChange: 1.36, momPct: "+1.00%" },
                { date: "4/30/2025", value: 136.50, momChange: -1.49, momPct: "-1.08%" },
                { date: "5/31/2025", value: 136.74, momChange: 0.24, momPct: "+0.18%" },
                { date: "6/30/2025", value: 136.48, momChange: -0.26, momPct: "-0.19%" },
                { date: "7/31/2025", value: 133.33, momChange: -3.16, momPct: "-2.31%" },
                { date: "8/31/2025", value: 134.46, momChange: 1.14, momPct: "+0.85%" },
                { date: "9/30/2025", value: 133.16, momChange: -1.30, momPct: "-0.97%" }
            ]
        };

        // --- RENDER LOGIC ---

        async function initDashboard() {
            // Show loading state
            document.getElementById('lastUpdated').textContent = 'Loading live data...';
            
            try {
                // Fetch live data from APIs
                const liveData = await fetchLiveData();
                
                // Update dashboard with live values
                if (liveData.fredCount > 0 || liveData.sheetCount > 0) {
                    updateDashboardWithLiveData(liveData);
                }
            } catch (error) {
                console.error('Live data fetch failed, using cached data:', error);
                dashboardData.lastUpdated = dashboardData.lastUpdated + ' (Cached)';
            }
            
            // Render all components
            document.getElementById('lastUpdated').textContent = `Last Updated: ${dashboardData.lastUpdated}`;
            renderScores();
            renderMetrics();
            renderCosts();
            renderLegislation();
            renderCrashTracker();
            renderRegional();
            renderInvestments();
            renderEconomicChart();
            renderKey3();
            
            // Show data source indicator
            showDataSourceIndicator();
        }
        
        function showDataSourceIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'data-source-indicator';
            indicator.innerHTML = `
                <span class="source-dot live"></span> Live from FRED API
                <span class="source-dot cached"></span> Cached/Spreadsheet
            `;
            document.querySelector('.header').appendChild(indicator);
        }

        function renderScores() {
            const container = document.getElementById('scoreContainer');
            dashboardData.scores.forEach((score, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                let colorClass = `text-${score.range}`;
                let bgClass = `bg-${score.range}`;
                
                card.innerHTML = `
                    <div class="score-title">${score.title}</div>
                    <div class="score-value ${colorClass}">${score.value}</div>
                    <div class="score-status ${colorClass} ${bgClass}">
                        ${score.statusText}
                    </div>
                `;
                container.appendChild(card);
                
                const legendCard = document.getElementById(`legendCard${index}`);
                if (legendCard) {
                    legendCard.setAttribute('data-color', score.range);
                }
            });
        }

        function renderMetrics() {
            const tbody = document.getElementById('housingMetricsBody');
            
            // Section: Home Prices
            tbody.innerHTML += `<tr class="section-header"><td colspan="6" style="padding-top: 10px; font-weight: 700; color: var(--accent-orange);">üè† Home Prices</td></tr>`;
            dashboardData.homeMetrics.forEach(item => {
                tbody.innerHTML += createMetricRow(item);
            });
            
            // Section: Mortgage & Rates
            tbody.innerHTML += `<tr class="section-header"><td colspan="6" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üí∞ Mortgage & Rates</td></tr>`;
            dashboardData.mortgageMetrics.forEach(item => {
                tbody.innerHTML += createMetricRow(item);
            });
            
            // Section: Affordability
            tbody.innerHTML += `<tr class="section-header"><td colspan="6" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üìä Affordability Indices</td></tr>`;
            dashboardData.affordabilityMetrics.forEach(item => {
                tbody.innerHTML += createMetricRow(item);
            });
            
            // Section: Supply
            tbody.innerHTML += `<tr class="section-header"><td colspan="6" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üì¶ Housing Supply</td></tr>`;
            dashboardData.supplyMetrics.forEach(item => {
                tbody.innerHTML += createMetricRow(item);
            });
        }
        
        function createMetricRow(item) {
            const isNegative = item.pctChange.includes('-');
            // For rates and prices, context matters. Lower rates = good (green), higher home prices = bad (red)
            const isGoodChange = (item.name.includes('Rate') || item.name.includes('Mortgage') || item.name.includes('Inflation')) ? isNegative : !isNegative;
            return `
                <tr>
                    <td><strong>${getSourceLink(item.name)}</strong></td>
                    <td>${item.current}</td>
                    <td>${item.start}</td>
                    <td class="${isNegative ? 'text-green' : 'text-red'}">${item.pctChange}</td>
                    <td><span class="trend ${getTrendClass(item.status)}">${item.status}</span></td>
                </tr>
            `;
        }

        function renderCosts() {
            const tbody = document.getElementById('costTrackerBody');
            
            // Builder Materials
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 10px; font-weight: 700; color: var(--accent-orange);">üî® Builder Materials</td></tr>`;
            dashboardData.builderExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Food & Groceries
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üçé Food & Groceries</td></tr>`;
            dashboardData.foodExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Utilities & Housing
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">‚ö° Utilities & Housing</td></tr>`;
            dashboardData.utilitiesExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Insurance
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üõ°Ô∏è Insurance</td></tr>`;
            dashboardData.insuranceExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Transportation
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üöó Transportation</td></tr>`;
            dashboardData.transportExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Home & Appliances
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üè° Home & Appliances</td></tr>`;
            dashboardData.homeAppliancesExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
            
            // Personal & Other
            tbody.innerHTML += `<tr class="section-header"><td colspan="5" style="padding-top: 20px; font-weight: 700; color: var(--accent-orange);">üë§ Personal & Other</td></tr>`;
            dashboardData.personalExpenses.forEach(item => {
                tbody.innerHTML += createCostRow(item);
            });
        }
        
        function createCostRow(item) {
            const isDrop = item.trend.toLowerCase().includes('drop');
            const isMajor = item.trend.toLowerCase().includes('major');
            let trendClass = isDrop ? 'trend-down' : (item.trend === 'Stable' ? 'trend-stable' : 'trend-up');
            return `
                <tr>
                    <td><strong>${getSourceLink(item.name)}</strong></td>
                    <td>${item.current}</td>
                    <td>${item.start}</td>
                    <td>${item.pctChange}</td>
                    <td><span class="trend ${trendClass}">${item.trend}</span></td>
                </tr>
            `;
        }

        function renderLegislation() {
            const tbody = document.getElementById('billTrackerBody');
            dashboardData.legislation.forEach(item => {
                const row = `
                    <tr>
                        <td class="text-orange">${getSourceLink(item.id)}</td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.status}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderCrashTracker() {
            const tbody = document.getElementById('crashTrackerBody');
            dashboardData.crashFactors.forEach(item => {
                const row = `
                    <tr>
                        <td>
                            <strong>${getSourceLink(item.name)}</strong>
                            <div style="font-size: 11px; color: var(--text-secondary);">${item.category}</div>
                        </td>
                        <td>${item.value}</td>
                        <td style="text-align: center; font-weight: 600;">${item.points}</td>
                        <td><span class="score-status bg-${item.color} text-${item.color}">${item.risk}</span></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderRegional() {
            const container = document.getElementById('regionalContainer');
            const tbody = document.getElementById('regionalTableBody');
            
            dashboardData.regionalData.forEach(region => {
                // Determine color based on affordability index
                let color = 'red';
                if (region.affordability >= 125) color = 'green';
                else if (region.affordability >= 100) color = 'yellow';
                else if (region.affordability >= 80) color = 'orange';
                
                const isPositiveChange = region.yearlyChange.includes('+');
                
                // Regional card
                const card = document.createElement('div');
                card.className = 'regional-card';
                card.innerHTML = `
                    <h4>${region.region} ${getSourceBadge(region.region)}</h4>
                    <div class="affordability-value text-${color}">${region.affordability}</div>
                    <div class="affordability-change ${isPositiveChange ? 'text-green' : 'text-red'}">
                        ${region.yearlyChange} YoY
                    </div>
                    <div class="home-price">Median: ${region.resaleHome}</div>
                `;
                container.appendChild(card);
                
                // Table row
                const row = `
                    <tr>
                        <td><strong>${getSourceLink(region.region)}</strong></td>
                        <td>${region.resaleHome}</td>
                        <td>${region.qualifyingIncome}</td>
                        <td>${region.familyIncome}</td>
                        <td>${region.mortgage}</td>
                        <td class="text-${color}"><strong>${region.affordability}</strong></td>
                        <td class="${isPositiveChange ? 'text-green' : 'text-red'}">${region.yearlyChange}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderInvestments() {
            const assetsTbody = document.getElementById('assetsTableBody');
            const yieldsTbody = document.getElementById('yieldsTableBody');
            
            // Render assets
            dashboardData.investments.forEach(item => {
                const momPositive = item.momChange.includes('+');
                const yoyPositive = item.yoyChange.includes('+');
                const row = `
                    <tr>
                        <td><strong>${getSourceLink(item.name)}</strong></td>
                        <td>${item.value}</td>
                        <td class="${momPositive ? 'text-green' : 'text-red'}">${item.momChange}</td>
                        <td class="${yoyPositive ? 'text-green' : 'text-red'}">${item.yoyChange}</td>
                    </tr>
                `;
                assetsTbody.innerHTML += row;
            });
            
            // Render treasury yields
            dashboardData.treasuryYields.forEach(item => {
                const momPositive = item.momChange.includes('+');
                const yoyPositive = item.yoyChange.includes('+');
                const row = `
                    <tr>
                        <td><strong>${getSourceLink(item.term)}</strong></td>
                        <td>${item.rate}</td>
                        <td class="${momPositive ? 'text-green' : 'text-red'}">${item.momChange}</td>
                        <td class="${yoyPositive ? 'text-green' : 'text-red'}">${item.yoyChange}</td>
                    </tr>
                `;
                yieldsTbody.innerHTML += row;
            });
        }

        function renderEconomicChart() {
            const ctx = document.getElementById('economicChart').getContext('2d');
            const data = dashboardData.economicIndex;
            
            // Get latest data points
            const latest = data[data.length - 1];
            const yearAgo = data.find(d => d.date === '9/30/2024') || data[data.length - 5];
            
            // Update stats
            document.getElementById('currentIndex').textContent = latest.value.toFixed(2);
            document.getElementById('sinceBaseline').textContent = '+' + (latest.value - 100).toFixed(1) + '%';
            
            if (yearAgo) {
                const yoyDiff = ((latest.value - yearAgo.value) / yearAgo.value * 100).toFixed(1);
                const yoyEl = document.getElementById('yoyChange');
                yoyEl.textContent = (yoyDiff >= 0 ? '+' : '') + yoyDiff + '%';
                yoyEl.className = 'stat-value ' + (yoyDiff >= 0 ? 'text-red' : 'text-green');
            }
            
            if (latest.momPct) {
                const momEl = document.getElementById('momChange');
                momEl.textContent = latest.momPct;
                momEl.className = 'stat-value ' + (latest.momChange >= 0 ? 'text-red' : 'text-green');
            }
            
            // Create chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: 'Economic Cost Index',
                        data: data.map(d => d.value),
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 3,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#f97316'
                    }, {
                        label: 'Baseline (2019 Q1)',
                        data: data.map(() => 100),
                        borderColor: '#22c55e',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#94a3b8' }
                        },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            titleColor: '#f8fafc',
                            bodyColor: '#94a3b8',
                            borderColor: '#334155',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#94a3b8', maxTicksLimit: 12 },
                            grid: { color: '#33415540' }
                        },
                        y: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#33415540' },
                            min: 95,
                            max: 145
                        }
                    }
                }
            });
        }

        function getTrendClass(status) {
            if (status.includes('Rise')) return 'trend-up';
            if (status.includes('Drop')) return 'trend-down';
            return 'trend-stable';
        }

        function switchView(viewName) {
            // Hide all
            document.getElementById('metricsView').style.display = 'none';
            document.getElementById('costsView').style.display = 'none';
            document.getElementById('legislationView').style.display = 'none';
            document.getElementById('regionalView').style.display = 'none';
            document.getElementById('investmentsView').style.display = 'none';
            document.getElementById('economicView').style.display = 'none';
            
            // Show selected
            document.getElementById(viewName + 'View').style.display = 'block';

            // Update Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function toggleLegend() {
            const content = document.getElementById('legendContent');
            const toggle = document.getElementById('legendToggle');
            content.classList.toggle('hidden');
            toggle.classList.toggle('collapsed');
        }

        function toggleKey3() {
            const content = document.getElementById('key3Content');
            const toggle = document.getElementById('key3Toggle');
            content.classList.toggle('hidden');
            toggle.classList.toggle('collapsed');
        }

        function renderKey3() {
            const supply = dashboardData.scores[1]; // Supply Score
            const affordability = dashboardData.scores[2]; // Affordability Score
            const crash = dashboardData.scores[3]; // Crash Likelihood
            const health = dashboardData.scores[0]; // Housing Health
            
            // Calculate inverted crash (100 - crash score)
            const invertedCrash = 100 - crash.value;
            
            // Calculate contributions
            const supplyContrib = (supply.value * 0.35).toFixed(2);
            const affordContrib = (affordability.value * 0.45).toFixed(2);
            const crashContrib = (invertedCrash * 0.20).toFixed(2);
            const total = (parseFloat(supplyContrib) + parseFloat(affordContrib) + parseFloat(crashContrib)).toFixed(2);
            
            // Update component values
            document.querySelector('#key3Supply .key3-value').textContent = supply.value;
            document.querySelector('#key3Supply .key3-value').className = `key3-value text-${supply.range}`;
            document.querySelector('#key3Supply').style.borderColor = `var(--accent-${supply.range})`;
            
            document.querySelector('#key3Affordability .key3-value').textContent = affordability.value;
            document.querySelector('#key3Affordability .key3-value').className = `key3-value text-${affordability.range}`;
            document.querySelector('#key3Affordability').style.borderColor = `var(--accent-${affordability.range})`;
            
            document.querySelector('#key3Crash .key3-value').textContent = invertedCrash.toFixed(2);
            document.querySelector('#key3Crash .key3-value').className = `key3-value text-${crash.range}`;
            document.querySelector('#key3Crash').style.borderColor = `var(--accent-${crash.range})`;
            
            document.querySelector('#key3Result .key3-value').textContent = health.value;
            document.querySelector('#key3Result .key3-value').className = `key3-value text-${health.range}`;
            
            // Update breakdown calculations
            document.getElementById('calcSupply').innerHTML = `${supply.value} √ó 0.35 = <strong>${supplyContrib}</strong>`;
            document.getElementById('calcAffordability').innerHTML = `${affordability.value} √ó 0.45 = <strong>${affordContrib}</strong>`;
            document.getElementById('calcCrash').innerHTML = `(100 - ${crash.value}) √ó 0.20 = <strong>${crashContrib}</strong>`;
            document.getElementById('calcTotal').innerHTML = `${supplyContrib} + ${affordContrib} + ${crashContrib} = <strong class="text-${health.range}">${total}</strong>`;
        }

        // Initialize
        initDashboard();

    </script>
</body>
</html>
